<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°ì´í„° ë¡œë”© í…ŒìŠ¤íŠ¸ - ì„œìš¸ ì§‘ê°’ ëŒ€ì‹œë³´ë“œ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: #0d1117;
            color: #e6edf3;
            padding: 24px;
            min-height: 100vh;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #58a6ff, #bc8cff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            color: #8b949e;
            font-size: 14px;
            margin-bottom: 24px;
        }

        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 24px;
        }

        .test-card {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 12px;
            padding: 20px;
        }

        .test-card h3 {
            font-size: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-badge.loading {
            background: rgba(136, 192, 255, 0.15);
            color: #58a6ff;
        }

        .status-badge.success {
            background: rgba(63, 185, 80, 0.15);
            color: #3fb950;
        }

        .status-badge.error {
            background: rgba(248, 81, 73, 0.15);
            color: #f85149;
        }

        .status-badge.warning {
            background: rgba(210, 153, 34, 0.15);
            color: #d29922;
        }

        .spinner {
            width: 14px;
            height: 14px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .result-box {
            background: #0d1117;
            border: 1px solid #21262d;
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
            font-family: 'SF Mono', 'Consolas', monospace;
            font-size: 13px;
            line-height: 1.6;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 12px;
            font-size: 13px;
        }

        .data-table th,
        .data-table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #21262d;
        }

        .data-table th {
            color: #8b949e;
            font-weight: 500;
            font-size: 12px;
            text-transform: uppercase;
        }

        .data-table tr:hover {
            background: rgba(88, 166, 255, 0.05);
        }

        .highlight-diff {
            color: #f0883e;
            font-weight: 600;
        }

        .highlight-same {
            color: #8b949e;
        }

        .highlight-supabase {
            color: #3fb950;
            font-weight: 600;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .btn {
            padding: 8px 20px;
            border: 1px solid #30363d;
            background: #21262d;
            color: #e6edf3;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 13px;
            transition: all 0.2s;
        }

        .btn:hover {
            background: #30363d;
            border-color: #58a6ff;
        }

        .btn-primary {
            background: linear-gradient(135deg, #238636, #2ea043);
            border-color: #238636;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #2ea043, #3fb950);
        }

        .btn-group {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }

        .summary-row {
            display: flex;
            gap: 24px;
            margin-top: 12px;
        }

        .summary-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .summary-label {
            font-size: 12px;
            color: #8b949e;
        }

        .summary-value {
            font-size: 20px;
            font-weight: 700;
        }

        .summary-value.green {
            color: #3fb950;
        }

        .summary-value.red {
            color: #f85149;
        }

        .summary-value.yellow {
            color: #d29922;
        }
    </style>
</head>

<body>
    <h1>ğŸ” ë°ì´í„° ë¡œë”© ì§„ë‹¨ í…ŒìŠ¤íŠ¸</h1>
    <p class="subtitle">Supabaseì—ì„œ ì‹¤ì œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p>

    <div class="test-grid">
        <!-- Test 1: Supabase ì—°ê²° -->
        <div class="test-card">
            <h3>â‘  Supabase ì—°ê²° ìƒíƒœ</h3>
            <div id="test1-status">
                <span class="status-badge loading"><span class="spinner"></span> í…ŒìŠ¤íŠ¸ ì¤‘...</span>
            </div>
            <div class="result-box" id="test1-result">ì—°ê²° í™•ì¸ ì¤‘...</div>
        </div>

        <!-- Test 2: Districts í…Œì´ë¸” -->
        <div class="test-card">
            <h3>â‘¡ Districts í…Œì´ë¸” ì¡°íšŒ</h3>
            <div id="test2-status">
                <span class="status-badge loading"><span class="spinner"></span> í…ŒìŠ¤íŠ¸ ì¤‘...</span>
            </div>
            <div class="result-box" id="test2-result">ë°ì´í„° ì¡°íšŒ ì¤‘...</div>
        </div>

        <!-- Test 3: Housing Prices í…Œì´ë¸” -->
        <div class="test-card">
            <h3>â‘¢ Housing Prices í…Œì´ë¸” ì¡°íšŒ</h3>
            <div id="test3-status">
                <span class="status-badge loading"><span class="spinner"></span> í…ŒìŠ¤íŠ¸ ì¤‘...</span>
            </div>
            <div class="result-box" id="test3-result">ë°ì´í„° ì¡°íšŒ ì¤‘...</div>
        </div>

        <!-- Test 4: Edge Function -->
        <div class="test-card">
            <h3>â‘£ Edge Function ìƒíƒœ</h3>
            <div id="test4-status">
                <span class="status-badge loading"><span class="spinner"></span> í…ŒìŠ¤íŠ¸ ì¤‘...</span>
            </div>
            <div class="result-box" id="test4-result">í•¨ìˆ˜ í˜¸ì¶œ ì¤‘...</div>
        </div>

        <!-- Test 5: ë°ì´í„° ë¹„êµ -->
        <div class="test-card full-width">
            <h3>â‘¤ í•˜ë“œì½”ë”© ë°ì´í„° vs Supabase ë°ì´í„° ë¹„êµ</h3>
            <div id="test5-status">
                <span class="status-badge loading"><span class="spinner"></span> ë¹„êµ ì¤‘...</span>
            </div>
            <div id="test5-result"></div>
        </div>

        <!-- ì¢…í•© ê²°ê³¼ -->
        <div class="test-card full-width">
            <h3>ğŸ“Š ì¢…í•© ì§„ë‹¨ ê²°ê³¼</h3>
            <div id="summary-result">
                <span class="status-badge loading"><span class="spinner"></span> ì „ì²´ í…ŒìŠ¤íŠ¸ ì§„í–‰ ì¤‘...</span>
            </div>
            <div class="summary-row" id="summary-stats" style="display:none;"></div>
            <div class="btn-group">
                <button class="btn btn-primary" onclick="runAllTests()">ğŸ”„ ì „ì²´ ì¬í…ŒìŠ¤íŠ¸</button>
                <button class="btn" onclick="testEdgeFunctionSync()">âš¡ Edge Function ë™ê¸°í™” ì‹œë„</button>
            </div>
        </div>
    </div>

    <script>
        // ========================================
        // Supabase Configuration (same as app.js)
        // ========================================
        const SUPABASE_URL = 'https://kspzqwtlpeibbeskfwdc.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_nCC6kt-KDpugNANJo7hU9A_Ak0XCIAz';

        let sb = null;

        // í•˜ë“œì½”ë”©ëœ ë°ì´í„° (app.js ê¸°ë³¸ê°’ê³¼ ë™ì¼)
        const HARDCODED_SAMPLE = {
            gangnam: { weekly: 0.18, monthly: 0.52, yearly: 6.8 },
            seocho: { weekly: 0.20, monthly: 0.58, yearly: 7.2 },
            yongsan: { weekly: 0.21, monthly: 0.62, yearly: 7.8 },
            songpa: { weekly: 0.19, monthly: 0.55, yearly: 6.9 },
            dobong: { weekly: 0.04, monthly: 0.15, yearly: 1.8 },
        };

        // ========================================
        // Helper Functions
        // ========================================
        function setStatus(id, type, text) {
            const icons = { loading: `<span class="spinner"></span>`, success: 'âœ…', error: 'âŒ', warning: 'âš ï¸' };
            document.getElementById(id).innerHTML =
                `<span class="status-badge ${type}">${icons[type]} ${text}</span>`;
        }

        function setResult(id, content) {
            document.getElementById(id).innerHTML = content;
        }

        // ========================================
        // Test 1: Supabase ì—°ê²°
        // ========================================
        async function test1_connection() {
            try {
                sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

                // ê°„ë‹¨í•œ ì¿¼ë¦¬ë¡œ ì—°ê²° í…ŒìŠ¤íŠ¸
                const { data, error } = await sb.from('districts').select('id').limit(1);

                if (error) {
                    setStatus('test1-status', 'error', 'ì—°ê²° ì‹¤íŒ¨');
                    setResult('test1-result',
                        `âŒ Supabase ì—°ê²° ì‹¤íŒ¨\n\nURL: ${SUPABASE_URL}\nError: ${error.message}\nCode: ${error.code}\nHint: ${error.hint || 'N/A'}`);
                    return false;
                }

                setStatus('test1-status', 'success', 'ì—°ê²° ì„±ê³µ');
                setResult('test1-result',
                    `âœ… Supabase ì—°ê²° ì„±ê³µ!\n\nURL: ${SUPABASE_URL}\nì‘ë‹µ ë°ì´í„°: ${JSON.stringify(data, null, 2)}`);
                return true;

            } catch (e) {
                setStatus('test1-status', 'error', 'ì—°ê²° ì˜¤ë¥˜');
                setResult('test1-result', `âŒ ì˜ˆì™¸ ë°œìƒ: ${e.message}`);
                return false;
            }
        }

        // ========================================
        // Test 2: Districts í…Œì´ë¸”
        // ========================================
        async function test2_districts() {
            if (!sb) {
                setStatus('test2-status', 'error', 'Supabase ë¯¸ì—°ê²°');
                setResult('test2-result', 'âŒ Supabase ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                return null;
            }

            try {
                const { data, error } = await sb.from('districts').select('*');

                if (error) {
                    setStatus('test2-status', 'error', 'ì¡°íšŒ ì‹¤íŒ¨');
                    setResult('test2-result', `âŒ Error: ${error.message}`);
                    return null;
                }

                if (!data || data.length === 0) {
                    setStatus('test2-status', 'warning', 'ë°ì´í„° ì—†ìŒ');
                    setResult('test2-result', 'âš ï¸ districts í…Œì´ë¸”ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.\nâ†’ seed-data.sqlì„ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤.');
                    return null;
                }

                setStatus('test2-status', 'success', `${data.length}ê°œ êµ¬ í™•ì¸`);

                let table = '<table class="data-table"><thead><tr><th>ID</th><th>ì´ë¦„</th><th>ì½”ë“œ</th></tr></thead><tbody>';
                data.forEach(d => {
                    table += `<tr><td>${d.id}</td><td>${d.name}</td><td>${d.code}</td></tr>`;
                });
                table += '</tbody></table>';

                setResult('test2-result', table);
                return data;

            } catch (e) {
                setStatus('test2-status', 'error', 'ì˜¤ë¥˜');
                setResult('test2-result', `âŒ ì˜ˆì™¸: ${e.message}`);
                return null;
            }
        }

        // ========================================
        // Test 3: Housing Prices í…Œì´ë¸”
        // ========================================
        async function test3_prices() {
            if (!sb) {
                setStatus('test3-status', 'error', 'Supabase ë¯¸ì—°ê²°');
                setResult('test3-result', 'âŒ Supabase ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                return null;
            }

            try {
                const { data, error, count } = await sb
                    .from('housing_prices')
                    .select('*', { count: 'exact' })
                    .order('period_value', { ascending: false })
                    .limit(20);

                if (error) {
                    setStatus('test3-status', 'error', 'ì¡°íšŒ ì‹¤íŒ¨');
                    setResult('test3-result', `âŒ Error: ${error.message}`);
                    return null;
                }

                if (!data || data.length === 0) {
                    setStatus('test3-status', 'warning', 'ë°ì´í„° ì—†ìŒ');
                    setResult('test3-result', 'âš ï¸ housing_prices í…Œì´ë¸”ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.\nâ†’ seed-data.sqlì„ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤.');
                    return null;
                }

                // ê¸°ê°„ë³„ í†µê³„
                const stats = { weekly: 0, monthly: 0, yearly: 0 };
                const { data: allData } = await sb.from('housing_prices').select('period_type');
                if (allData) {
                    allData.forEach(d => stats[d.period_type]++);
                }

                setStatus('test3-status', 'success', `ì´ ${allData ? allData.length : data.length}ê±´`);

                let content = `<div style="margin-bottom:12px;">
                    ğŸ“ˆ ì£¼ê°„(weekly): <strong>${stats.weekly}</strong>ê±´ |
                    ğŸ“… ì›”ê°„(monthly): <strong>${stats.monthly}</strong>ê±´ |
                    ğŸ“Š ì—°ê°„(yearly): <strong>${stats.yearly}</strong>ê±´
                </div>`;
                content += '<table class="data-table"><thead><tr><th>êµ¬</th><th>ê¸°ê°„</th><th>ê¸°ê°„ê°’</th><th>ìƒìŠ¹ë¥ </th></tr></thead><tbody>';
                data.slice(0, 15).forEach(d => {
                    content += `<tr>
                        <td>${d.district_id}</td>
                        <td>${d.period_type}</td>
                        <td>${d.period_value}</td>
                        <td>${d.rate >= 0 ? '+' : ''}${d.rate}%</td>
                    </tr>`;
                });
                content += '</tbody></table>';
                if (data.length > 15) content += `<div style="color:#8b949e;margin-top:8px;">... ê·¸ ì™¸ ${(allData ? allData.length : data.length) - 15}ê±´</div>`;

                setResult('test3-result', content);
                return data;

            } catch (e) {
                setStatus('test3-status', 'error', 'ì˜¤ë¥˜');
                setResult('test3-result', `âŒ ì˜ˆì™¸: ${e.message}`);
                return null;
            }
        }

        // ========================================
        // Test 4: Edge Function
        // ========================================
        async function test4_edgeFunction() {
            try {
                const response = await fetch(
                    `${SUPABASE_URL}/functions/v1/fetch-housing-data?action=sync-data`,
                    {
                        method: 'GET',
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Content-Type': 'application/json'
                        }
                    }
                );

                const status = response.status;
                let body;
                try {
                    body = await response.json();
                } catch {
                    body = await response.text();
                }

                if (response.ok) {
                    setStatus('test4-status', 'success', `HTTP ${status}`);
                    setResult('test4-result',
                        `âœ… Edge Function ì‘ë‹µ ì„±ê³µ\n\nHTTP Status: ${status}\nì‘ë‹µ:\n${JSON.stringify(body, null, 2)}`);
                    return true;
                } else {
                    setStatus('test4-status', 'error', `HTTP ${status}`);
                    setResult('test4-result',
                        `âŒ Edge Function ì˜¤ë¥˜\n\nHTTP Status: ${status}\nì‘ë‹µ:\n${JSON.stringify(body, null, 2)}`);
                    return false;
                }

            } catch (e) {
                setStatus('test4-status', 'warning', 'í˜¸ì¶œ ì‹¤íŒ¨');
                setResult('test4-result',
                    `âš ï¸ Edge Function í˜¸ì¶œ ì‹¤íŒ¨\n\nì˜¤ë¥˜: ${e.message}\n\nâ†’ Edge Functionì´ ì•„ì§ ë°°í¬ë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nâ†’ ì´ ê²½ìš° Supabaseì˜ seed ë°ì´í„°ë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤.`);
                return false;
            }
        }

        // ========================================
        // Test 5: ë°ì´í„° ë¹„êµ
        // ========================================
        async function test5_compare() {
            if (!sb) {
                setStatus('test5-status', 'error', 'Supabase ë¯¸ì—°ê²°');
                setResult('test5-result', '<div class="result-box">âŒ Supabase ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤.</div>');
                return;
            }

            try {
                // Supabaseì—ì„œ ìµœì‹  ì£¼ê°„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const { data: prices } = await sb
                    .from('housing_prices')
                    .select('district_id, period_type, rate, period_value')
                    .in('district_id', Object.keys(HARDCODED_SAMPLE))
                    .order('period_value', { ascending: false });

                if (!prices || prices.length === 0) {
                    setStatus('test5-status', 'warning', 'ë¹„êµ ë¶ˆê°€');
                    setResult('test5-result', '<div class="result-box">âš ï¸ Supabaseì— ë¹„êµí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>');
                    return;
                }

                // êµ¬ë³„ë¡œ ìµœì‹ ê°’ ì¶”ì¶œ
                const supabaseData = {};
                prices.forEach(p => {
                    if (!supabaseData[p.district_id]) supabaseData[p.district_id] = {};
                    if (!supabaseData[p.district_id][p.period_type]) {
                        supabaseData[p.district_id][p.period_type] = parseFloat(p.rate);
                    }
                });

                let identical = 0;
                let different = 0;
                let table = `<table class="data-table">
                    <thead><tr>
                        <th>êµ¬</th><th>ê¸°ê°„</th>
                        <th>í•˜ë“œì½”ë”© ê°’</th><th>Supabase ê°’</th><th>ê²°ê³¼</th>
                    </tr></thead><tbody>`;

                const districtNames = {
                    gangnam: 'ê°•ë‚¨êµ¬', seocho: 'ì„œì´ˆêµ¬', yongsan: 'ìš©ì‚°êµ¬',
                    songpa: 'ì†¡íŒŒêµ¬', dobong: 'ë„ë´‰êµ¬'
                };

                Object.entries(HARDCODED_SAMPLE).forEach(([id, hardcoded]) => {
                    ['weekly', 'monthly', 'yearly'].forEach(period => {
                        const hcVal = hardcoded[period];
                        const sbVal = supabaseData[id]?.[period];
                        const isSame = sbVal !== undefined && Math.abs(hcVal - sbVal) < 0.001;

                        if (isSame) identical++; else different++;

                        table += `<tr>
                            <td>${districtNames[id]}</td>
                            <td>${period}</td>
                            <td>${hcVal.toFixed(2)}%</td>
                            <td>${sbVal !== undefined ? sbVal.toFixed(2) + '%' : '<span style="color:#f85149">ì—†ìŒ</span>'}</td>
                            <td>${isSame
                                ? '<span class="highlight-same">ë™ì¼ âœ“</span>'
                                : sbVal !== undefined
                                    ? '<span class="highlight-diff">âš¡ ë‹¤ë¦„ (Supabase ë°ì´í„° ì‚¬ìš© ì¤‘)</span>'
                                    : '<span style="color:#f85149">âŒ ë¯¸ì¡´ì¬</span>'
                            }</td>
                        </tr>`;
                    });
                });

                table += '</tbody></table>';

                if (different > 0 && Object.values(supabaseData).some(d => Object.keys(d).length > 0)) {
                    setStatus('test5-status', 'success', `Supabase ë°ì´í„° ê°ì§€`);
                } else if (identical > 0 && different === 0) {
                    setStatus('test5-status', 'warning', `í•˜ë“œì½”ë”© ê°’ê³¼ ë™ì¼`);
                } else {
                    setStatus('test5-status', 'warning', 'ë¹„êµ ì™„ë£Œ');
                }

                setResult('test5-result', `
                    <div style="margin-bottom:12px;">
                        ë™ì¼: <strong>${identical}</strong>ê±´ |
                        ì°¨ì´: <strong class="highlight-diff">${different}</strong>ê±´
                    </div>
                    ${table}
                    <div style="margin-top:12px;color:#8b949e;font-size:12px;">
                        ğŸ’¡ ê°’ì´ "ë‹¤ë¦„"ì´ë©´ Supabaseì˜ ì‹¤ë°ì´í„°ê°€ ì‚¬ìš© ì¤‘ì…ë‹ˆë‹¤.<br>
                        ğŸ’¡ ê°’ì´ "ë™ì¼"ì´ë©´ í•˜ë“œì½”ë”© ë°ì´í„°ì™€ Supabase ì‹œë“œ ë°ì´í„°ê°€ ê°™ìŠµë‹ˆë‹¤. (seed-data.sqlì˜ ê°’ì´ í•˜ë“œì½”ë”©ê³¼ ë™ì¼í•˜ê²Œ ì„¤ì •ë¨)
                    </div>
                `);

            } catch (e) {
                setStatus('test5-status', 'error', 'ë¹„êµ ì‹¤íŒ¨');
                setResult('test5-result', `<div class="result-box">âŒ ì˜ˆì™¸: ${e.message}</div>`);
            }
        }

        // ========================================
        // ì¢…í•© ê²°ê³¼
        // ========================================
        function showSummary(results) {
            const el = document.getElementById('summary-result');
            const statsEl = document.getElementById('summary-stats');

            const passCount = Object.values(results).filter(v => v === true).length;
            const failCount = Object.values(results).filter(v => v === false).length;
            const warnCount = Object.values(results).filter(v => v === null).length;

            let statusType, statusText;
            if (failCount === 0 && warnCount === 0) {
                statusType = 'success';
                statusText = 'ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼! âœ… ì‹¤ì œ ë°ì´í„°ê°€ ì •ìƒì ìœ¼ë¡œ ë¡œë“œë˜ê³  ìˆìŠµë‹ˆë‹¤.';
            } else if (failCount === 0) {
                statusType = 'warning';
                statusText = 'ë¶€ë¶„ ì„±ê³µ â€” ì¼ë¶€ í•­ëª© í™•ì¸ í•„ìš”';
            } else {
                statusType = 'error';
                statusText = 'ì¼ë¶€ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ â€” ì•„ë˜ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”';
            }

            el.innerHTML = `<span class="status-badge ${statusType}">${statusText}</span>`;

            statsEl.style.display = 'flex';
            statsEl.innerHTML = `
                <div class="summary-item">
                    <span class="summary-label">í†µê³¼</span>
                    <span class="summary-value green">${passCount}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">ì‹¤íŒ¨</span>
                    <span class="summary-value red">${failCount}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">ê²½ê³ </span>
                    <span class="summary-value yellow">${warnCount}</span>
                </div>
            `;
        }

        // ========================================
        // Edge Function ë™ê¸°í™” ì‹œë„
        // ========================================
        async function testEdgeFunctionSync() {
            setStatus('test4-status', 'loading', 'ë™ê¸°í™” ì‹œë„ ì¤‘...');
            const result = await test4_edgeFunction();

            if (result) {
                // ë™ê¸°í™” ì„±ê³µ â†’ ë°ì´í„° ë‹¤ì‹œ í™•ì¸
                await test3_prices();
                await test5_compare();
            }
        }

        // ========================================
        // ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        // ========================================
        async function runAllTests() {
            // Reset all
            ['test1', 'test2', 'test3', 'test4', 'test5'].forEach(id => {
                setStatus(id + '-status', 'loading', 'í…ŒìŠ¤íŠ¸ ì¤‘...');
            });
            document.getElementById('summary-result').innerHTML =
                '<span class="status-badge loading"><span class="spinner"></span> ì „ì²´ í…ŒìŠ¤íŠ¸ ì§„í–‰ ì¤‘...</span>';
            document.getElementById('summary-stats').style.display = 'none';

            const results = {};

            // Test 1: ì—°ê²°
            results.connection = await test1_connection();

            // Test 2: Districts
            const districts = await test2_districts();
            results.districts = districts !== null;

            // Test 3: Prices
            const prices = await test3_prices();
            results.prices = prices !== null;

            // Test 4: Edge Function
            results.edgeFunction = await test4_edgeFunction();

            // Test 5: ë¹„êµ
            await test5_compare();

            // ì¢…í•©
            showSummary(results);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', runAllTests);
    </script>
</body>

</html>